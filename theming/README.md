# Theming

Client-side applications using a Brightspot [Content Delivery API](https://www.brightspot.com/documentation/brightspot-cms-developer-guide/cda-guides) (CDA) may have a need for presentation logic delivered via the API, but want that data decoupled from core data models. Brightspot provides a solution with [theming](https://www.brightspot.com/documentation/brightspot-cms-developer-guide/latest/data-modeling-for-themes).


This example demonstrates implementing Brightspot theming via a CDA endpoint to access presentation logic.

## What you will learn
1. [Create a theme](#1-create-a-theme).
2. [Configure theme global styling](#2-configure-theme-global-styling).
3. [Configure theme content styling](#3-configure-theme-content-styling).
4. [Add theme to a CDA endpoint](#4-add-theme-to-cda-endpoint).
5. [Use theme fields in a front-end application](#5-use-theme-fields-in-a-front-end-application).

## Running the example application

> **_Note_** Just starting? Refer to the [README](/README.md) at the root of the `react-examples` repository for details on running example applications in depth.

Run the following commands from the `theming/app` directory:

### Install dependencies

```sh
$ yarn
```

```
[1/4] üîç Resolving packages...
[2/4] üöö Fetching packages...
[3/4] üîó Linking dependencies...
[4/4] üî® Building fresh packages...
‚ú® Done in 6.03s.
```

### Start the React app

```sh
$ yarn start
```

```
Compiled successfully!
```

The React app opens automatically in the browser.

## Using the example application

<details>
<summary>
<span>
<b>Generate a theme zip file</b>
</span>
</summary>

CD into `theming/brightspot`, and run the following command to generate a new `custom-theme.zip` file in the `theming/brightspot` directory.

```sh
$ yarn run config
```

</details>

<details>
<summary>
<span>
<b>
Upload a theme
</b>
</span>
</summary>

Navigate from **&#x2630;** to **Admin** &rarr; **Themes** &rarr; **New Theme**. In the **MAIN** section for **New Theme**, add a name. Click the **CHOOSE** button next to the **New Upload** dropdown list. Select the zip file created in step 1. Click **SAVE**.
</details>

<details>
<summary>
<span>
<b>Create a site</b>
</span>
</summary>

Navigate from **&#x2630;** to **Admin** &rarr; **Sites & Settings**, and select **New Site**. Add a name, and for the theme, select **Shared**, then the name of the theme you created. Click **SAVE**.
</details>

<details>
<summary>
<span>
<b>Create an API client</b>
</span>
</summary>

Navigate from **&#x2630;** to **Admin** &rarr; **APIs**, and select **New Api Client**. Add a name, and select the **Theming Endpoint** from the **Endpoints** dropdown list. Add the site you created in step 4 under **Permissions**. Click **SAVE**.
</details>

<details>
<summary>
<span>
<b>Apply theme and API endpoint to client</b>
</span>
</summary> 

Navigate from **&#x2630;** to **Admin** &rarr; **APIs**, and select **Theming Endpoint**. Select your theme from the **Theme** dropdown list. Select your API Client from the **Attributional Client** dropdown list. Click **SAVE**. 
</details>

<details>
<summary>
<span>
<b>Add theme global styles</b>
</span>
</summary>

Navigate from **&#x2630;** to **Admin** &rarr; **Themes** &rarr; **&lt;Theme Name&gt;**. There is a new tab: **Overrides**. Select styles in the **Overrides** tab and save. Refresh the front-end application page to see the applied overriding styles. These styling overrides are applied globally for the respective endpoint.
</details>

<details>
<summary>
<span>
<b>Add theme content styles</b>
</span>
</summary>

Click **+** at the top of the page in Brightspot, then **Theming Article** from the dropdown list. In the **New Theming Article** form, add a title, body, and unique slug. Click the **Styles** tab.  Expand the **Theming Article Styles** section and select **Custom** from the **Preset** dropdown list. Select styling from the options available. Click **PUBLISH**. Refresh the front-end application page to see the Theming Article and content styles.
</details>

## How everything works

### 1. Create a theme

  - [`_config.json`](/theming/brightspot/_config.json): This file provides the core information for a theme. A theme configuration file may consist of the following fields:
    - `themeFields`: Fields for global theme styling.
    - `colorPalette`: Fields to create a color palette for easier color selection.
    - `styles`: Fields for content styling.

    ```json5
    {
      "themeFields": {},
      "styles": {},
      "colorPalette": {}
    }
    ```

    Brightspot accepts theme files as zip files. In this example, the theme zip file is generated by running the script `yarn run config`, which executes the [`config.sh`](/theming/brightspot/config.sh) file. 

### 2. Configure theme global styling

- `themeFields`: Add theme global styling fields to this root configuration field.
 
  <i>Theme configuration</i>:
    ```json5
    "themeFields": {
        "primaryColor": {
          "displayName": "Primary Color",
          "type": "color",
          "cms.ui.placeholder": "#ff0083"
        }, 
    ```

  Refer to the [data modeling for themes](https://www.brightspot.com/documentation/brightspot-cms-developer-guide/latest/data-modeling-for-themes#field-options) documentation to learn more about field types and field options. 
### 3. Configure theme content styling

- [`@ViewTemplate`](/theming/brightspot/src/brightspot/example/theming/ThemeArticleViewModel.ts): View interfaces with this annotation have a string field, `_viewTemplate`, added to their object type that returns the value of the annotation. 

  <i>View model</i>:

  ```typescript
  @ViewInterface
  @ViewTemplate({ value: '/themingArticle' })
  export default class ThemingArticleViewModel extends JavaClass(
    'brightspot.example.theming.ThemingArticleViewModel',
    ViewModel.Of(ThemingArticle),
  ```

- `styles`: Add theme content styling fields to this root configuration field.

  <i>Theme configuration</i>:

    ```json5
    "styles": {
        "/themingArticle": {  // same name as @ViewTemplate value
          "fields": { // fields for content item
            "showHappyFace": {
              "type": "boolean"
            }
          }
        "/<someOtherViewInterface>": {
          "fields":  {...}
        } 
    ```

  > **_Note_**: The view template name must have a preceeding forward slash. Ex: `@ViewTemplate({ value: "/themingArticle" })`.

### 4. Add theme to CDA Endpoint

- [`ThemingEndpoint.ts`](/theming/brightspot/src/brightspot/example/theming/ThemingEndpoint.ts): Implement the `ContentDeliveryApiThemeable` interface to enable applying themes to a CDA endpoint. Make sure your theme is applied to the endpoint. 

### 5. Use theme fields in a front-end application

- `_Theme`: When a theme is applied to an endpoint, the endpoint will expose a `_Theme` root field for theme global styling.

  ```graphql
  query MyQuery {
    _Theme {
      bodyFont
      alignment
      primaryColor
      primaryTextColor
      secondaryColor
      secondaryTextColor
    }
  }
  ```

- `_viewTemplate`: Content items with a `@ViewTemplate` annotation will expose this field.

  ```graphql
  query MyQuery {
    ThemeArticle(model: {slug: "my-article"}) {
      _viewTemplate // value returned in this example is "/themingArticle"
    }
  }
  ```

- `_style`: Content items with a `@ViewTemplate` annotation will also expose this field. If the theme is not applied to a site, the value returned is null.

  ```graphql
  query MyQuery {
    ThemeArticle(model: {slug: "my-article"}) {
      _style {
        happyFaceColor
        showHappyFace
      }
    }
  }
  ```

## Try it yourself
The following are suggestions for learning more about theming:
1. Add new `themeFields` and/or `fields` and try to using those fields in your front-end application. 

    > **_Note_**: Remember to generate a new theme zip file if you make changes to the `_config.json` file. Run `yarn run config` in the `brightspot` directory to update the `custom-theme.zip` file. Then navigate from **&#x2630;** to **Admin** &rarr; **Themes**, and select your theme. Select **New File** to upload the new theme zip file.

2. Read the [Brightspot documentation](https://www.brightspot.com/documentation/brightspot-cms-developer-guide/latest/data-modeling-for-themes) on theming to learn more about theming. 

## Troubleshooting

- Q: I am getting the following error: 
  ```sh
  There was an error fetching data: Validation error (FieldUndefined@[_Theme]) : Field '_Theme' in type 'Query' is undefined...
  ```

    - A: Make sure you added your theme to your endpoint (see step 5 in [Using the Example Application](#using-the-example-application)).

Having other issues running the example application? Refer to the [Common Issues](/README.md) section in the respository README for assistance.