# Theming

Client-side applications using a Brightspot [Content Delivery API](https://www.brightspot.com/documentation/brightspot-cms-developer-guide/cda-guides) (CDA) may have a need for presentation logic delivered via the API, but want that data decoupled from core data models. Brightspot provides a solution with theming.


This example demonstrates implementing Brightspot [theming](https://www.brightspot.com/documentation/brightspot-cms-developer-guide/latest/data-modeling-for-themes) via a CDA endpoint to access presentation logic.

## What you will learn
1. [Create a theme](#1-create-a-theme)
2. [Configure theme content styling](#2-configure-theme-content-styling)
3. [Configure theme global styling](#3-configure-theme-global-styling)
4. [Add a theme to a CDA endpoint](#4-add-a-theme-to-a-cda-endpoint).
5. [Use theme fields in a front-end application](#5-use-theme-fields-in-a-front-end-application)

## Running the example application

> **_Note_** Just starting? Refer to the [README](/README.md) at the root of the `react-examples` repository for details on running example applications in depth.

Run the following commands from the `theming/app` directory:

### Install dependencies

```sh
$ yarn
```

```
[1/4] 🔍 Resolving packages...
[2/4] 🚚 Fetching packages...
[3/4] 🔗 Linking dependencies...
[4/4] 🔨 Building fresh packages...
✨ Done in 6.03s.
```

### Start the React app

```sh
$ yarn start
```

```
Compiled successfully!
```

The React app opens automatically in the browser.

## Using the example application

The front-end application displays the title "Brightspot Theming".  

1. Generate a theme zip file:
    CD into `theming/brightspot`, and run the following command to generate a `custom-theme.zip` file in the `theming/brightspot` directory if one does not already exist:

```sh
$ yarn run config
```    

2. Upload a theme to Brightspot:
  Navigate from **&#x2630;** to **Admin** &rarr; **Themes** &rarr; **New Theme**. In the **MAIN** section for **New Theme**, add a name. Click on the **CHOOSE** button next to the **New Upload** dropdown menu. Select the zip file created in step 1, then click **SAVE**.
&nbsp;  
3. Apply the theme to your endpoint:
  Navigate from **&#x2630;** to **Admin** &rarr; **APIs**, and select **Theming Endpoint**. Select the theme you created, then click **SAVE**.  
&nbsp;
4. Create a site:
  Navigate from **&#x2630;** to **Admin** &rarr; **Sites & Settings**, and select **New Site**. Add a name, and for the theme, select **Shared**, then the name of the theme you created. Add a URL (for this example, use "http://localhost:3000/custom-theme"). Click **SAVE**. Check your front-end application - nothing has changed. This is expected since you have not selected overiding styles from the theme you applied.  
&nbsp;
5. Add theme global overriding styles:
  Navigate back to the theme you created in Brightspot. There is a new tab: **Overrides**. Select styles in the **Overrides** tab and save. Refresh the front-end application page to see the applied overriding styles. These styling overrides are applied globally for the respective endpoint.
&nbsp;
6. Add content styles:
  In Brightspot, create a **Theming Article** by clicking **+** at the top of the page, then **Theming Article** from the dropdown menu. In the **New Theming Article** form, add a title, body, and unique slug. Click the **Styles** tab.  Expand the **Theming Article Styles** section and select **Custom** from the **Preset** dropdown menu. Select styling from the options available. Finally, click **PUBLISH**. Refresh the front-end application page to see the Theming Article and content styles.

## How everything works

### 1. Create a theme

  [`_config.json`](/theming/brightspot/_config.json): This file provides the core information for a theme. A theme configuration file may consist of the following fields:
  - `themeFields`: Fields for global theme styling.
  - `colorPalette`: Fields to create a color palette for easier color selection.
  - `styles`: Fields for content styling.

  ```json5
  {
    "themeFields": {},
    "styles": {},
    "colorPalette": {}
  }
  ```

  Brightspot accepts theme files as zip files. In this example, the theme zip file is generated by running the script `yarn run config`, which executes the [`config.sh`](/theming/brightspot/config.sh) file. 

### 2. Configure theme content styling

[`@ViewTemplate`](/theming/brightspot/src/brightspot/example/theming/ThemeArticleViewModel.ts): View interfaces with this annotation will have a string field, `_viewTemplate`, added to their object type that will return the value of the annotation. 

View Model:
```typescript
@ViewInterface
@ViewTemplate({ value: '/themingArticle' })
export default class ThemingArticleViewModel extends JavaClass(
  'brightspot.example.theming.ThemingArticleViewModel',
  ViewModel.Of(ThemingArticle),
```

Theme configuration:
```json5
 "styles": {
    "/themingArticle": {  // same name as @ViewTemplate value
      "fields": {
```

> **_Note_** The template name must have a preceeding forward slash. Ex: `@ViewTemplate({ value: "/themingArticle" })`.

[`fields`](/theming/brightspot/_config.json): Content specific theme styling fields.

Theme configuration:

```json5
 "fields": {
        "alignment": {
          "type": "text",  // type of field
          "displayName": "Title alignment", // name displayed in Brightspot UI
          "cms.ui.note": "Select preferred alignment.", // any additional notes
          "cms.ui.dropDown": true, // dropdown option
          "values": [ //dropdown values
            {
              "label": "Left",
              "value": "left"
            },
            {
              "label": "Middle",
              "value": "middle"
            },
            {
              "label": "right",
              "value": "right"
            }
          ]
        },
```

### 3. Configure theme global styling

[`themeFields`](/theming/brightspot/_config.json): Global theme styling fields.

Theme configuration:

```json5
 "themeFields": {
    "primaryColor": {
      "displayName": "Primary Color",
      "type": "color",
      "cms.ui.placeholder": "#ff0083"
    },
```

### 4. Add a theme to a CDA Endpoint

- [`ThemingEndpoint.ts`](/theming/brightspot/src/brightspot/example/theming/ThemingEndpoint.ts): Implement the `ContentDeliveryApiThemeable` interface to enable applying themes to a CDA endpoint. Make sure a theme is applied to the endpoint. Theme global fields are available for any site accessed from the respective endpoint. Add a theme to a site to access content styling fields. 

### 5. Use theme fields in a front-end application

When a theme is applied to an endpoint, the endpoint will expose a `_Theme` root field:

```graphql
 query MyQuery {
  _Theme {
    bodyFont
    buttonStyle
    primaryColor
    primaryTextColor
    secondaryColor
    secondaryTextColor
  }
}
```

Example response:

```json5
{
  "data": {
    "_Theme": {
      "bodyFont": "Merriweather",
      "buttonStyle": "button-primary",
      "primaryColor": "#c912bc",
      "primaryTextColor": "#483939",
      "secondaryColor": "#30d221",
      "secondaryTextColor": "#242db6"
    }
  }
}

```

Content style fields are available for a front-end application using a site with the theme applied. Content items with a `@ViewTemplate` annotation applied will have the `_viewTemplate` and `_style` fields. Sites with the theme applied will show the various content style fields - if the site is not applied, the value returned for `_style` is null. 

```graphql
 query MyQuery {
  ThemeArticle(model: {slug: "great"}) {
    _viewTemplate
    _style {
      alignment
      sampleColor
      sampleNumber
      showHappyFace
    }
  }
}
```


Example response:

```json5
{
  "data": {
    "ThemingArticles": {
      "themingArticles": [
        {
          "_style": {
            "alignment": "right",
            "sampleColor": "#30d221",
            "sampleNumber": 2,
            "showHappyFace": true
          },
          "_viewTemplate": "/themingArticle"
        }
      ]
    }
  }
}
```

These fields can be used in the front end to dynamically change presentation. 

## Try it yourself
The following are suggestions for learning more about with Brightspot:

1. Add a new `themeField` or `fields` and try to using those fields in your front-end application. 

    Remember to generate a new theme zip file if you make any changes to the `_config.json` file. Run `yarn run config` in the `brightspot` directory to update the `custom-theme.zip` file. Then navigate from **&#x2630;** to **Admin** &rarr; **Themes**, and select your theme. Select **New File** to upload the new theme zip file.
  &nbsp;
2. Try adding a color palette option to your theme.   If `colorPalette` is set in the theme, the **Color Palette** tab appears after uploading the theme. 
&nbsp;

    Example color palette:

  <img  width=300 alt="Color Palette for Color Picker" src="brightspot/documentation/images/colorPalette.png">

&nbsp;
3. Read the [Brightspot documentation](https://www.brightspot.com/documentation/brightspot-cms-developer-guide/latest/data-modeling-for-themes) on theming to learn more about theming. 

## Troubleshooting
Having issues running the example application? Refer to the [Common Issues](/README.md) section in the respository README for assistance.